module.exports=[91033,e=>{"use strict";var t=e.i(47909),n=e.i(74017),r=e.i(96250),a=e.i(59756),o=e.i(61916),s=e.i(74677),l=e.i(69741),i=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),h=e.i(70101),g=e.i(26937),m=e.i(10372),f=e.i(93695);e.i(52474);var y=e.i(220),w=e.i(89171),v=e.i(98043);let R=Symbol.for("constructDateFrom");function E(e,t){var n;return n=t||e,"function"==typeof n?n(e):n&&"object"==typeof n&&R in n?n[R](e):n instanceof Date?new n.constructor(e):new Date(e)}let S={};function x(e,t){let n=E(e,t?.in),r=n.getMonth();return n.setMonth(r-r%3,1),n.setHours(0,0,0,0),n}function C(e,t){let n=E(e,t?.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function b(e,t){let n=E(e,t?.in),r=n.getFullYear();return n.setFullYear(r+1,0,0),n.setHours(23,59,59,999),n}async function O(e){try{let t=e.headers.get("x-user-id")||"demo-user",n=e.nextUrl.searchParams;if(!v.prisma)return w.NextResponse.json({error:"Database not available"},{status:503});let r=n.get("period")||"monthly",a=n.get("date")?new Date(n.get("date")):new Date,{start:o,end:s}=function(e,t=new Date){switch(e){case"daily":default:let n,r;return{start:((n=E(t,void 0)).setHours(0,0,0,0),n),end:((r=E(t,void 0)).setHours(23,59,59,999),r)};case"weekly":let a,o,s,l,i,u;return{start:(a=(void 0)??void 0??S.weekStartsOn??S.locale?.options?.weekStartsOn??0,s=(o=E(t,void 0)).getDay(),o.setDate(o.getDate()-(7*(s<a)+s-a)),o.setHours(0,0,0,0),o),end:(l=(void 0)??void 0??S.weekStartsOn??S.locale?.options?.weekStartsOn??0,u=(i=E(t,void 0)).getDay(),i.setDate(i.getDate()+((u<l?-7:0)+6-(u-l))),i.setHours(23,59,59,999),i)};case"monthly":let d,c,p;return{start:((d=E(t,void 0)).setDate(1),d.setHours(0,0,0,0),d),end:(p=(c=E(t,void 0)).getMonth(),c.setFullYear(c.getFullYear(),p+1,0),c.setHours(23,59,59,999),c)};case"quarterly":let h,g;return{start:x(t),end:(g=(h=E(t,void 0)).getMonth(),h.setMonth(g-g%3+3,0),h.setHours(23,59,59,999),h)};case"half_year":let m=6>x(t).getMonth()?C(t):new Date(t.getFullYear(),6,1),f=6>m.getMonth()?new Date(m.getFullYear(),5,30):b(m);return{start:m,end:f};case"yearly":return{start:C(t),end:b(t)}}}(r,a),l=await v.prisma.trade.findMany({where:{userId:t,status:"closed",entryTime:{gte:o,lte:s}},include:{strategy:!0,entryModel:!0,timeframeSequence:{include:{steps:{orderBy:{orderIndex:"asc"}}}},ruleViolations:{include:{rule:!0}}},orderBy:{entryTime:"desc"}}),i=l.filter(e=>e.profitLoss>0),u=l.filter(e=>e.profitLoss<0),d=l.reduce((e,t)=>e+(t.profitLoss||0),0),c={};for(let e of l){let t=e.strategy?.name||"Unassigned";c[t]||(c[t]={wins:0,losses:0,pnl:0,count:0}),c[t].count++,c[t].pnl+=e.profitLoss||0,e.profitLoss>0&&c[t].wins++,e.profitLoss<0&&c[t].losses++}let p=Object.entries(c).map(([e,t])=>({name:e,...t})).sort((e,t)=>t.pnl-e.pnl),h=p[0],g=p[p.length-1],m={};for(let e of l){let t=e.entryModel?.name||"Unassigned";m[t]||(m[t]={wins:0,losses:0,pnl:0,count:0}),m[t].count++,m[t].pnl+=e.profitLoss||0,e.profitLoss>0&&m[t].wins++,e.profitLoss<0&&m[t].losses++}let f=Object.entries(m).map(([e,t])=>({name:e,...t})).sort((e,t)=>t.pnl-e.pnl),y=f[0],R=f[f.length-1],O=function(e){let t={};for(let n of e)n.emotionalState&&(t[n.emotionalState]||(t[n.emotionalState]={count:0,wins:0,pnl:0}),t[n.emotionalState].count++,n.profitLoss>0&&t[n.emotionalState].wins++,t[n.emotionalState].pnl+=n.profitLoss||0);return t}(l),D=function(e){let t={},n=0;for(let r of e)for(let e of(0===r.ruleViolations.filter(e=>e.violated).length&&n++,r.ruleViolations)){let n=e.rule.ruleName;t[n]||(t[n]={violations:0,adherenceRate:0}),e.violated&&t[n].violations++}return{overallAdherence:e.length>0?n/e.length*100:0,ruleBreakdown:t}}(l),N=await v.prisma.periodSummary.upsert({where:{userId_period_startDate:{userId:t,period:r,startDate:o}},update:{totalTrades:l.length,winCount:i.length,lossCount:u.length,winRate:l.length>0?i.length/l.length*100:0,expectancy:l.length>0?d/l.length:0,bestStrategy:h?.name||null,worstStrategy:g?.name||null,bestEntryModel:y?.name||null,emotionalPatterns:JSON.stringify(O),behavioralTrends:JSON.stringify({ruleAdherence:D}),improvementsNeeded:JSON.stringify({lowPerformanceAreas:p.filter(e=>e.pnl<0),emotionalChallenges:Object.entries(O).filter(([e,t])=>t.count>0&&t.wins/t.count<.5).map(([e,t])=>e),ruleViolations:Object.entries(c).filter(([e,t])=>t.violations>0)})},create:{userId:t,period:r,startDate:o,endDate:s,totalTrades:l.length,winCount:i.length,lossCount:u.length,winRate:l.length>0?i.length/l.length*100:0,expectancy:l.length>0?d/l.length:0,bestStrategy:h?.name||null,worstStrategy:g?.name||null,bestEntryModel:y?.name||null,emotionalPatterns:JSON.stringify(O),behavioralTrends:JSON.stringify({ruleAdherence:D}),improvementsNeeded:JSON.stringify({lowPerformanceAreas:p.filter(e=>e.pnl<0),emotionalChallenges:Object.entries(O).filter(([e,t])=>t.count>0&&t.wins/t.count<.5).map(([e,t])=>e),ruleViolations:p.filter(e=>e.count-e.wins-e.losses>0)})}});return w.NextResponse.json({period:r,startDate:o,endDate:s,summary:N,detailedAnalysis:{totalTrades:l.length,wins:i.length,losses:u.length,totalPnL:d,winRate:l.length>0?(i.length/l.length*100).toFixed(2):0,expectancy:(d/l.length).toFixed(2),bestStrategy:h?{name:h.name,pnl:h.pnl,winRate:h.wins/h.count}:null,worstStrategy:g?{name:g.name,pnl:g.pnl,winRate:g.wins/g.count}:null,bestEntryModel:y?{name:y.name,pnl:y.pnl}:null,worstEntryModel:R?{name:R.name,pnl:R.pnl}:null,emotionalPatterns:O,ruleAdherence:D}})}catch(e){return console.error("Error generating period summary:",e),w.NextResponse.json({error:"Failed to generate period summary"},{status:500})}}e.s(["GET",()=>O],43362);var D=e.i(43362);let N=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/analytics/summary/route",pathname:"/api/analytics/summary",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/analytics/summary/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:A,workUnitAsyncStorage:T,serverHooks:P}=N;function H(){return(0,r.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:T})}async function M(e,t,r){N.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/analytics/summary/route";w=w.replace(/\/index$/,"")||"/";let v=await N.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:S,parsedUrl:x,isDraftMode:C,prerenderManifest:b,routerServerContext:O,isOnDemandRevalidate:D,revalidateOnlyGenerated:A,resolvedPathname:T,clientReferenceManifest:P,serverActionsManifest:H}=v,M=(0,l.normalizeAppPath)(w),_=!!(b.dynamicRoutes[M]||b.routes[T]),F=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,x,!1):t.end("This page could not be found"),null);if(_&&!C){let e=!!b.routes[T],t=b.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await F();throw new f.NoFallbackError}}let k=null;!_||N.isDev||C||(k="/index"===(k=T)?"/":k);let U=!0===N.isDev||!_,I=_&&!U;H&&P&&(0,s.setManifestsSingleton)({page:w,clientReferenceManifest:P,serverActionsManifest:H});let j=e.method||"GET",q=(0,o.getTracer)(),L=q.getActiveScopeSpan(),$={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,a)=>N.onRequestError(e,t,r,a,O)},sharedContext:{buildId:R}},B=new i.NodeNextRequest(e),K=new i.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>N.handle(V,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=q.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${j} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${w}`)}),l=!!(0,a.getRequestMeta)(e,"minimalMode"),i=async a=>{var o,i;let u=async({previousCacheEntry:n})=>{try{if(!l&&D&&A&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(a);e.fetchMetrics=$.renderOpts.fetchMetrics;let i=$.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let u=$.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(B,K,o,$.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:D})},!1,O),t}},d=await N.handleResponse({req:e,nextConfig:S,cacheKey:k,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:A,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!_)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(i=d.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",D?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&_||f.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,K,new Response(d.value.body,{headers:f,status:d.value.status||200})),null};L?await i(L):await q.withPropagatedContext(e.headers,()=>q.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},i))}catch(t){if(t instanceof f.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:D})},!1,O),_)throw t;return await (0,p.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>H,"routeModule",()=>N,"serverHooks",()=>P,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>T],91033)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_2b364d65.js.map