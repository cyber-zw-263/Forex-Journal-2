{"version":3,"sources":["../../../src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n// Safe Prisma provider: only instantiate Prisma when DATABASE_URL looks valid for supported providers.\n// This prevents dev servers and serverless hosts without DB configured from crashing.\nlet prisma: PrismaClient | null = null;\n\nfunction createPrisma() {\n  try {\n    const client = new PrismaClient();\n    // Attempt a quick connect to surface immediate errors in dev\n    client.$connect().catch((err) => {\n      console.warn('Prisma client connection failed during initialization:', err?.message || err);\n      // don't throw here; keep client assigned but allow callers to handle query errors\n    });\n    return client;\n  } catch (err) {\n    console.warn('Failed to create Prisma client:', err);\n    return null;\n  }\n}\n\ntry {\n  const url = (process.env.DATABASE_URL || '').trim();\n  const isSqlite = url.startsWith('file:');\n  const isPg = url.startsWith('postgres') || url.startsWith('postgresql:');\n\n  if (url && (isSqlite || isPg)) {\n    prisma = createPrisma();\n  } else {\n    console.warn('Prisma disabled: DATABASE_URL not set to sqlite or postgres. API routes should handle missing DB.');\n  }\n} catch (err) {\n  console.warn('Prisma initialization error:', err);\n  prisma = null;\n}\n\nasync function disconnectPrisma() {\n  try {\n    if (prisma) await prisma.$disconnect();\n  } catch (err) {\n    console.warn('Error disconnecting Prisma:', err);\n  }\n}\n\n// graceful shutdown\nif (typeof process !== 'undefined') {\n  process.on?.('SIGINT', async () => {\n    await disconnectPrisma();\n    process.exit(0);\n  });\n}\n\nexport { prisma, createPrisma, disconnectPrisma };\n"],"names":[],"mappings":"omCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAIA,IAAI,EAA8B,KAiBlC,GAAI,CACF,IAAM,EAAM,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAI,EAAA,CAAE,CAAE,IAAI,GAC3C,EAAW,EAAI,UAAU,CAAC,SAC1B,EAAO,EAAI,UAAU,CAAC,aAAe,EAAI,UAAU,CAAC,eAEtD,IAAQ,GAAD,AAAa,CAAA,CAAI,CAC1B,EAAS,AArBb,AAoBiC,SApBxB,EACP,GAAI,CACF,IAAM,EAAS,IAAI,EAAA,YAAY,CAM/B,OAJA,EAAO,QAAQ,GAAG,KAAK,CAAC,AAAC,IACvB,QAAQ,IAAI,CAAC,yDAA0D,GAAK,SAAW,EAEzF,GACO,CACT,CAAE,MAAO,EAAK,CAEZ,OADA,QAAQ,IAAI,CAAC,kCAAmC,GACzC,IACT,CACF,IAUI,QAAQ,IAAI,CAAC,oGAEjB,CAAE,MAAO,EAAK,CACZ,QAAQ,IAAI,CAAC,+BAAgC,GAC7C,EAAS,IACX,CAEA,eAAe,IACb,GAAI,CACE,GAAQ,MAAM,EAAO,WAAW,EACtC,CAAE,MAAO,EAAK,CACZ,QAAQ,IAAI,CAAC,8BAA+B,EAC9C,CACF,CAGuB,aAAnB,AAAgC,OAAzB,SACT,QAAQ,EAAE,GAAG,SAAU,UACrB,MAAM,IACN,QAAQ,IAAI,CAAC,EACf"}