module.exports=[47137,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(6704),e=a.i(27348);function f({onRecordingSaved:a}){let f=(0,c.useRef)(null),g=(0,c.useRef)([]),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(0),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a;return h&&(a=setInterval(()=>{k(a=>a+1)},1e3)),()=>clearInterval(a)},[h]);let p=async()=>{try{let b=await navigator.mediaDevices.getUserMedia({audio:!0});f.current=new MediaRecorder(b),g.current=[],f.current.ondataavailable=a=>{g.current.push(a.data)},f.current.onstop=()=>{(async()=>{let b=new Blob(g.current,{type:"audio/webm"}),c=URL.createObjectURL(b),e={id:Date.now().toString(),url:c,duration:j,timestamp:new Date,uploaded:!1};m(a=>[e,...a]),a?.(c);try{let a=new FormData;a.append("file",b,`voice-${Date.now()}.webm`);let c=await fetch("/api/voice-notes",{method:"POST",body:a,headers:{"x-user-id":"demo-user"}});if(c.ok){let a=await c.json();a?.url?m(b=>b.map(b=>b.id===e.id?{...b,url:a.url,uploaded:!0}:b)):m(a=>a.map(a=>a.id===e.id?{...a,uploaded:!0}:a)),d.default.success("Voice note uploaded")}else(0,d.default)("Saved locally (upload failed)",{icon:"⚠️"})}catch(a){console.error("Voice upload failed",a),(0,d.default)("Saved locally (upload failed)",{icon:"⚠️"})}})()},f.current.start(),i(!0),k(0)}catch(a){d.default.error("Unable to access microphone"),console.error(a)}},q=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Voice Notes"}),(0,b.jsx)("div",{className:"flex items-center gap-4 mb-4 flex-wrap",children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>{f.current&&h&&(f.current.stop(),i(!1),f.current.stream.getTracks().forEach(a=>a.stop()))},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors","aria-label":"Stop recording","aria-live":"polite",children:[(0,b.jsx)(e.FiStopCircle,{className:"w-5 h-5"}),"Stop"]}),(0,b.jsxs)("div",{className:"text-lg font-bold text-red-600 dark:text-red-400","aria-live":"polite",children:["Recording: ",q(j)]}),(0,b.jsx)("div",{className:"flex-1 h-1 bg-red-300 dark:bg-red-900 rounded-full relative overflow-hidden min-w-[100px]",children:(0,b.jsx)("div",{className:"h-full bg-red-600 animate-pulse",style:{width:"30%"}})})]}):(0,b.jsxs)("button",{onClick:p,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors","aria-label":"Start recording voice note",children:[(0,b.jsx)(e.FiMic,{className:"w-5 h-5"}),"Start Recording"]})}),l.length>0&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["Recordings (",l.length,")"]}),l.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-slate-700 p-3 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("button",{onClick:()=>o(n===a.id?null:a.id),className:"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors","aria-label":n===a.id?"Pause recording":"Play recording",children:(0,b.jsx)(e.FiPlay,{className:"w-4 h-4"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.timestamp.toLocaleTimeString()}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Duration: ",q(a.duration),a.uploaded&&(0,b.jsx)("span",{className:"ml-2",children:"✓ Uploaded"})]})]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void m(a=>a.filter(a=>a.id!==b))},className:"p-2 rounded-lg text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors","aria-label":`Delete recording from ${a.timestamp.toLocaleTimeString()}`,children:(0,b.jsx)(e.FiTrash2,{className:"w-4 h-4"})})]},a.id))]}),0===l.length&&!h&&(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center py-6",children:"No recordings yet. Start recording to add voice notes to your trades."})]}),n&&(0,b.jsx)("audio",{src:l.find(a=>a.id===n)?.url,autoPlay:!0,controls:!0,className:"w-full"},n)]})}function g({onScreenshotAdded:a}){let f=(0,c.useRef)(null),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(""),m=async b=>{let c=b.currentTarget.files;if(c){for(let b of Array.from(c))try{let c=new FileReader;c.onload=b=>{let c=b.target?.result,e={id:Date.now().toString()+Math.random(),url:c,caption:"",timestamp:new Date};h(a=>[e,...a]),a?.(c),d.default.success("Screenshot uploaded")},c.readAsDataURL(b)}catch(a){d.default.error("Failed to upload screenshot"),console.error(a)}f.current&&(f.current.value="")}},n=(a,b)=>{h(c=>c.map(c=>c.id===a?{...c,caption:b}:c)),j(null)};return(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Trade Setup Screenshots"}),(0,b.jsxs)("button",{onClick:()=>f.current?.click(),className:"w-full border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors","aria-label":"Upload screenshot by clicking or dragging files",children:[(0,b.jsx)(e.FiUpload,{className:"w-8 h-8 mx-auto mb-2 text-gray-600 dark:text-gray-400"}),(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Click to upload or drag & drop"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"}),(0,b.jsx)("input",{ref:f,type:"file",multiple:!0,accept:"image/*",onChange:m,className:"hidden","aria-label":"File input for screenshots"})]}),g.length>0&&(0,b.jsxs)("div",{className:"mt-6",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4",children:["Uploads (",g.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:g.map(a=>(0,b.jsxs)("div",{className:"relative group bg-gray-100 dark:bg-slate-700 rounded-lg overflow-hidden",children:[(0,b.jsx)("img",{src:a.url,alt:"Trade setup",className:"w-full h-40 object-cover"}),(0,b.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-between p-2",children:[(0,b.jsx)("button",{onClick:()=>{var b,c;let d;return b=a.url,c=a.timestamp,void((d=document.createElement("a")).href=b,d.download=`trade-setup-${c.toISOString()}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d))},className:"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors",title:"Download",children:(0,b.jsx)(e.FiDownload,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void h(a=>a.filter(a=>a.id!==b))},className:"p-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Delete",children:(0,b.jsx)(e.FiX,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-600",children:i===a.id?(0,b.jsx)("input",{autoFocus:!0,type:"text",value:k,onChange:a=>l(a.target.value),onBlur:()=>n(a.id,k),onKeyPress:b=>{"Enter"===b.key&&n(a.id,k)},placeholder:"Add caption...",className:"w-full px-2 py-1 border border-gray-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-xs focus:ring-2 focus:ring-blue-500 outline-none"}):(0,b.jsx)("p",{onClick:()=>{j(a.id),l(a.caption)},className:"text-xs text-gray-600 dark:text-gray-400 cursor-pointer hover:text-gray-900 dark:hover:text-white",children:a.caption||"Click to add caption..."})})]},a.id))})]})]})})}var h=a.i(42029);function i(){let{theme:a,toggleTheme:e}=(0,h.useTheme)(),[i]=(0,c.useState)(()=>!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)({whatLearned:"",mistakes:[],emotionalState:"calm",setupQuality:3}),[p,q]=(0,c.useState)("");(0,c.useEffect)(()=>{i&&(async()=>{try{let a=await fetch("/api/trades",{headers:{"x-user-id":"demo-user"}});if(!a.ok){let b=null;try{b=await a.json()}catch(c){b=await a.text()}console.error("Failed to fetch trades:",a.status,b),m([]);return}let b=await a.json();if(!Array.isArray(b)){console.warn("Unexpected trades payload in review page",b),m([]);return}m(b)}catch(a){console.error("Error fetching trades:",a)}})()},[i]);let r=l.find(a=>a.id===j),s=async()=>{if(r)try{(await fetch(`/api/trades/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"demo-user"},body:JSON.stringify({whatLearned:n.whatLearned,mistakes:JSON.stringify(n.mistakes),emotionalState:n.emotionalState,setupQuality:n.setupQuality})})).ok&&(d.default.success("Review saved"),k(null))}catch(a){d.default.error("Failed to save review")}};return i?(0,b.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"var(--background)"},children:[(0,b.jsxs)("main",{style:{maxWidth:"1200px",margin:"0 auto",padding:"32px 16px"},children:[(0,b.jsxs)("div",{style:{marginBottom:"32px"},children:[(0,b.jsx)("h1",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text-primary)",marginBottom:"8px",margin:0},children:"Trade Reviews"}),(0,b.jsx)("p",{style:{fontSize:"14px",color:"var(--text-secondary)",margin:0},children:"Deep dive into your trades and learn from them"})]}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px"},children:[(0,b.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,b.jsx)("h2",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:"Recent Trades"}),(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"500px",overflowY:"auto"},children:l.length>0?l.map(a=>(0,b.jsxs)("button",{onClick:()=>{k(a.id),o({whatLearned:a.whatLearned||"",mistakes:a.mistakes?JSON.parse(a.mistakes):[],emotionalState:a.emotionalState||"calm",setupQuality:a.setupQuality||3})},style:{width:"100%",textAlign:"left",padding:"12px",borderRadius:"8px",border:"none",backgroundColor:j===a.id?"var(--purple-base)":"var(--panel-muted)",color:j===a.id?"white":"var(--text-primary)",cursor:"pointer",transition:"all 0.2s ease",fontSize:"13px"},onMouseEnter:b=>{j!==a.id&&(b.currentTarget.style.backgroundColor="var(--card-border)")},onMouseLeave:b=>{j!==a.id&&(b.currentTarget.style.backgroundColor="var(--panel-muted)")},children:[(0,b.jsx)("div",{style:{fontWeight:"600",marginBottom:"4px"},children:a.pair}),(0,b.jsx)("div",{style:{fontSize:"11px",opacity:.75},children:new Date(a.entryTime).toLocaleDateString()})]},a.id)):(0,b.jsx)("p",{style:{fontSize:"13px",color:"var(--text-secondary)",textAlign:"center",padding:"16px",margin:0},children:"No trades yet"})})]}),r?(0,b.jsxs)("div",{style:{gridColumn:"auto / span 2",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,b.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,b.jsxs)("h2",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:[r.pair," - ",r.direction]}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px",fontSize:"13px"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Entry"}),(0,b.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:r.entryPrice.toFixed(5)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Exit"}),(0,b.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:r.exitPrice?.toFixed(5)||"Open"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"P&L"}),(0,b.jsx)("p",{style:{fontWeight:"600",color:r.profitLoss>=0?"var(--win-color)":"var(--loss-color)",margin:0},children:r.profitLoss?.toFixed(2)||"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Outcome"}),(0,b.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:r.outcome||"Open"})]})]})]}),(0,b.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,b.jsx)("h3",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:"Review Details"}),(0,b.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,b.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"What I Learned"}),(0,b.jsx)("textarea",{value:n.whatLearned,onChange:a=>o(b=>({...b,whatLearned:a.target.value})),placeholder:"What did this trade teach you?",style:{width:"100%",padding:"12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none",resize:"vertical",minHeight:"80px",fontFamily:"inherit"},onFocus:a=>{a.currentTarget.style.borderColor="var(--purple-base)"},onBlur:a=>{a.currentTarget.style.borderColor="var(--card-border)"}})]}),(0,b.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,b.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"Emotional State"}),(0,b.jsxs)("select",{value:n.emotionalState,onChange:a=>o(b=>({...b,emotionalState:a.target.value})),style:{width:"100%",padding:"8px 12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor="var(--purple-base)"},onBlur:a=>{a.currentTarget.style.borderColor="var(--card-border)"},children:[(0,b.jsx)("option",{children:"calm"}),(0,b.jsx)("option",{children:"rushed"}),(0,b.jsx)("option",{children:"frustrated"}),(0,b.jsx)("option",{children:"confident"}),(0,b.jsx)("option",{children:"fearful"})]})]}),(0,b.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,b.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"Setup Quality Rating"}),(0,b.jsxs)("select",{value:n.setupQuality,onChange:a=>o(b=>({...b,setupQuality:parseInt(a.target.value)})),style:{width:"100%",padding:"8px 12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none"},onFocus:a=>{a.currentTarget.style.borderColor="var(--purple-base)"},onBlur:a=>{a.currentTarget.style.borderColor="var(--card-border)"},children:[(0,b.jsx)("option",{value:"1",children:"⭐ Poor"}),(0,b.jsx)("option",{value:"2",children:"⭐⭐ Below Average"}),(0,b.jsx)("option",{value:"3",children:"⭐⭐⭐ Average"}),(0,b.jsx)("option",{value:"4",children:"⭐⭐⭐⭐ Good"}),(0,b.jsx)("option",{value:"5",children:"⭐⭐⭐⭐⭐ Excellent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"12px"},children:"Mistakes Made"}),(0,b.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:["Overtraded","Broke rules","Wrong entry point","Hesitated on trade","Exited too early","Exited too late","Ignored analysis","Bad position sizing","Emotion-driven"].map(a=>(0,b.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,b.jsx)("input",{type:"checkbox",checked:n.mistakes.includes(a),onChange:()=>{o(b=>({...b,mistakes:b.mistakes.includes(a)?b.mistakes.filter(b=>b!==a):[...b.mistakes,a]}))},style:{width:"16px",height:"16px",borderRadius:"4px",border:"1px solid var(--card-border)",cursor:"pointer",accentColor:"var(--purple-base)"}}),(0,b.jsx)("span",{style:{fontSize:"13px",color:"var(--text-primary)"},children:a})]},a))})]})]}),(0,b.jsx)("button",{onClick:s,style:{width:"100%",padding:"12px 16px",background:"linear-gradient(135deg, var(--purple-base) 0%, var(--purple-dark) 100%)",color:"white",fontWeight:"600",fontSize:"14px",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.transform="translateY(-1px)",a.currentTarget.style.boxShadow="0 8px 16px rgba(168, 85, 247, 0.3)"},onMouseLeave:a=>{a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="none"},children:"Save Review"})]}):(0,b.jsx)("div",{style:{gridColumn:"auto / span 2",backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"48px 20px",textAlign:"center"},children:(0,b.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,fontSize:"14px"},children:"Select a trade to review"})})]}),r&&(0,b.jsxs)("div",{style:{marginTop:"32px",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px"},children:[(0,b.jsx)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:(0,b.jsx)(f,{})}),(0,b.jsx)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:(0,b.jsx)(g,{})})]})]}),(0,b.jsx)(d.Toaster,{position:"bottom-right"})]}):(0,b.jsx)("div",{style:{minHeight:"100vh",backgroundColor:"var(--background)"}})}a.s(["default",()=>i],47137)}];

//# sourceMappingURL=src_app_review_page_tsx_d97b6247._.js.map