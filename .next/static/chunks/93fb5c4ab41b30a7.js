(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18924,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(5766),o=e.i(92199);function i({onRecordingSaved:e}){let i=(0,t.useRef)(null),l=(0,t.useRef)([]),[s,d]=(0,t.useState)(!1),[n,c]=(0,t.useState)(0),[p,x]=(0,t.useState)([]),[u,g]=(0,t.useState)(null);(0,t.useEffect)(()=>{let e;return s&&(e=setInterval(()=>{c(e=>e+1)},1e3)),()=>clearInterval(e)},[s]);let m=async()=>{try{let r=await navigator.mediaDevices.getUserMedia({audio:!0});i.current=new MediaRecorder(r),l.current=[],i.current.ondataavailable=e=>{l.current.push(e.data)},i.current.onstop=()=>{(async()=>{let r=new Blob(l.current,{type:"audio/webm"}),t=URL.createObjectURL(r),o={id:Date.now().toString(),url:t,duration:n,timestamp:new Date,uploaded:!1};x(e=>[o,...e]),e?.(t);try{let e=new FormData;e.append("file",r,`voice-${Date.now()}.webm`);let t=await fetch("/api/voice-notes",{method:"POST",body:e,headers:{"x-user-id":"demo-user"}});if(t.ok){let e=await t.json();e?.url?x(r=>r.map(r=>r.id===o.id?{...r,url:e.url,uploaded:!0}:r)):x(e=>e.map(e=>e.id===o.id?{...e,uploaded:!0}:e)),a.default.success("Voice note uploaded")}else(0,a.default)("Saved locally (upload failed)",{icon:"⚠️"})}catch(e){console.error("Voice upload failed",e),(0,a.default)("Saved locally (upload failed)",{icon:"⚠️"})}})()},i.current.start(),d(!0),c(0)}catch(e){a.default.error("Unable to access microphone"),console.error(e)}},h=e=>{let r=Math.floor(e/60);return`${r}:${(e%60).toString().padStart(2,"0")}`};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Voice Notes"}),(0,r.jsx)("div",{className:"flex items-center gap-4 mb-4 flex-wrap",children:s?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>{i.current&&s&&(i.current.stop(),d(!1),i.current.stream.getTracks().forEach(e=>e.stop()))},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors","aria-label":"Stop recording","aria-live":"polite",children:[(0,r.jsx)(o.FiStopCircle,{className:"w-5 h-5"}),"Stop"]}),(0,r.jsxs)("div",{className:"text-lg font-bold text-red-600 dark:text-red-400","aria-live":"polite",children:["Recording: ",h(n)]}),(0,r.jsx)("div",{className:"flex-1 h-1 bg-red-300 dark:bg-red-900 rounded-full relative overflow-hidden min-w-[100px]",children:(0,r.jsx)("div",{className:"h-full bg-red-600 animate-pulse",style:{width:"30%"}})})]}):(0,r.jsxs)("button",{onClick:m,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors","aria-label":"Start recording voice note",children:[(0,r.jsx)(o.FiMic,{className:"w-5 h-5"}),"Start Recording"]})}),p.length>0&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["Recordings (",p.length,")"]}),p.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-slate-700 p-3 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,r.jsx)("button",{onClick:()=>g(u===e.id?null:e.id),className:"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors","aria-label":u===e.id?"Pause recording":"Play recording",children:(0,r.jsx)(o.FiPlay,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.timestamp.toLocaleTimeString()}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Duration: ",h(e.duration),e.uploaded&&(0,r.jsx)("span",{className:"ml-2",children:"✓ Uploaded"})]})]})]}),(0,r.jsx)("button",{onClick:()=>{var r;return r=e.id,void x(e=>e.filter(e=>e.id!==r))},className:"p-2 rounded-lg text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors","aria-label":`Delete recording from ${e.timestamp.toLocaleTimeString()}`,children:(0,r.jsx)(o.FiTrash2,{className:"w-4 h-4"})})]},e.id))]}),0===p.length&&!s&&(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center py-6",children:"No recordings yet. Start recording to add voice notes to your trades."})]}),u&&(0,r.jsx)("audio",{src:p.find(e=>e.id===u)?.url,autoPlay:!0,controls:!0,className:"w-full"},u)]})}function l({onScreenshotAdded:e}){let i=(0,t.useRef)(null),[l,s]=(0,t.useState)([]),[d,n]=(0,t.useState)(null),[c,p]=(0,t.useState)(""),x=async r=>{let t=r.currentTarget.files;if(t){for(let r of Array.from(t))try{let t=new FileReader;t.onload=r=>{let t=r.target?.result,o={id:Date.now().toString()+Math.random(),url:t,caption:"",timestamp:new Date};s(e=>[o,...e]),e?.(t),a.default.success("Screenshot uploaded")},t.readAsDataURL(r)}catch(e){a.default.error("Failed to upload screenshot"),console.error(e)}i.current&&(i.current.value="")}},u=(e,r)=>{s(t=>t.map(t=>t.id===e?{...t,caption:r}:t)),n(null)};return(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Trade Setup Screenshots"}),(0,r.jsxs)("button",{onClick:()=>i.current?.click(),className:"w-full border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors","aria-label":"Upload screenshot by clicking or dragging files",children:[(0,r.jsx)(o.FiUpload,{className:"w-8 h-8 mx-auto mb-2 text-gray-600 dark:text-gray-400"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Click to upload or drag & drop"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"}),(0,r.jsx)("input",{ref:i,type:"file",multiple:!0,accept:"image/*",onChange:x,className:"hidden","aria-label":"File input for screenshots"})]}),l.length>0&&(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4",children:["Uploads (",l.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:l.map(e=>(0,r.jsxs)("div",{className:"relative group bg-gray-100 dark:bg-slate-700 rounded-lg overflow-hidden",children:[(0,r.jsx)("img",{src:e.url,alt:"Trade setup",className:"w-full h-40 object-cover"}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-between p-2",children:[(0,r.jsx)("button",{onClick:()=>{var r,t;let a;return r=e.url,t=e.timestamp,void((a=document.createElement("a")).href=r,a.download=`trade-setup-${t.toISOString()}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a))},className:"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white transition-colors",title:"Download",children:(0,r.jsx)(o.FiDownload,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>{var r;return r=e.id,void s(e=>e.filter(e=>e.id!==r))},className:"p-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Delete",children:(0,r.jsx)(o.FiX,{className:"w-4 h-4"})})]}),(0,r.jsx)("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-600",children:d===e.id?(0,r.jsx)("input",{autoFocus:!0,type:"text",value:c,onChange:e=>p(e.target.value),onBlur:()=>u(e.id,c),onKeyPress:r=>{"Enter"===r.key&&u(e.id,c)},placeholder:"Add caption...",className:"w-full px-2 py-1 border border-gray-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-xs focus:ring-2 focus:ring-blue-500 outline-none"}):(0,r.jsx)("p",{onClick:()=>{n(e.id),p(e.caption)},className:"text-xs text-gray-600 dark:text-gray-400 cursor-pointer hover:text-gray-900 dark:hover:text-white",children:e.caption||"Click to add caption..."})})]},e.id))})]})]})})}var s=e.i(9876);function d(){let{theme:e,toggleTheme:o}=(0,s.useTheme)(),[d]=(0,t.useState)(()=>!0),[n,c]=(0,t.useState)(null),[p,x]=(0,t.useState)([]),[u,g]=(0,t.useState)({whatLearned:"",mistakes:[],emotionalState:"calm",setupQuality:3}),[m,h]=(0,t.useState)("");(0,t.useEffect)(()=>{d&&(async()=>{try{let e=await fetch("/api/trades",{headers:{"x-user-id":"demo-user"}});if(!e.ok){let r=null;try{r=await e.json()}catch(t){r=await e.text()}console.error("Failed to fetch trades:",e.status,r),x([]);return}let r=await e.json();if(!Array.isArray(r)){console.warn("Unexpected trades payload in review page",r),x([]);return}x(r)}catch(e){console.error("Error fetching trades:",e)}})()},[d]);let y=p.find(e=>e.id===n),b=async()=>{if(y)try{(await fetch(`/api/trades/${y.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"demo-user"},body:JSON.stringify({whatLearned:u.whatLearned,mistakes:JSON.stringify(u.mistakes),emotionalState:u.emotionalState,setupQuality:u.setupQuality})})).ok&&(a.default.success("Review saved"),c(null))}catch(e){a.default.error("Failed to save review")}};return d?(0,r.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"var(--background)"},children:[(0,r.jsxs)("main",{style:{maxWidth:"1200px",margin:"0 auto",padding:"32px 16px"},children:[(0,r.jsxs)("div",{style:{marginBottom:"32px"},children:[(0,r.jsx)("h1",{style:{fontSize:"28px",fontWeight:"700",color:"var(--text-primary)",marginBottom:"8px",margin:0},children:"Trade Reviews"}),(0,r.jsx)("p",{style:{fontSize:"14px",color:"var(--text-secondary)",margin:0},children:"Deep dive into your trades and learn from them"})]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px"},children:[(0,r.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,r.jsx)("h2",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:"Recent Trades"}),(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",maxHeight:"500px",overflowY:"auto"},children:p.length>0?p.map(e=>(0,r.jsxs)("button",{onClick:()=>{c(e.id),g({whatLearned:e.whatLearned||"",mistakes:e.mistakes?JSON.parse(e.mistakes):[],emotionalState:e.emotionalState||"calm",setupQuality:e.setupQuality||3})},style:{width:"100%",textAlign:"left",padding:"12px",borderRadius:"8px",border:"none",backgroundColor:n===e.id?"var(--purple-base)":"var(--panel-muted)",color:n===e.id?"white":"var(--text-primary)",cursor:"pointer",transition:"all 0.2s ease",fontSize:"13px"},onMouseEnter:r=>{n!==e.id&&(r.currentTarget.style.backgroundColor="var(--card-border)")},onMouseLeave:r=>{n!==e.id&&(r.currentTarget.style.backgroundColor="var(--panel-muted)")},children:[(0,r.jsx)("div",{style:{fontWeight:"600",marginBottom:"4px"},children:e.pair}),(0,r.jsx)("div",{style:{fontSize:"11px",opacity:.75},children:new Date(e.entryTime).toLocaleDateString()})]},e.id)):(0,r.jsx)("p",{style:{fontSize:"13px",color:"var(--text-secondary)",textAlign:"center",padding:"16px",margin:0},children:"No trades yet"})})]}),y?(0,r.jsxs)("div",{style:{gridColumn:"auto / span 2",display:"flex",flexDirection:"column",gap:"24px"},children:[(0,r.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,r.jsxs)("h2",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:[y.pair," - ",y.direction]}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"16px",fontSize:"13px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Entry"}),(0,r.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:y.entryPrice.toFixed(5)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Exit"}),(0,r.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:y.exitPrice?.toFixed(5)||"Open"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"P&L"}),(0,r.jsx)("p",{style:{fontWeight:"600",color:y.profitLoss>=0?"var(--win-color)":"var(--loss-color)",margin:0},children:y.profitLoss?.toFixed(2)||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,marginBottom:"4px"},children:"Outcome"}),(0,r.jsx)("p",{style:{fontWeight:"600",color:"var(--text-primary)",margin:0},children:y.outcome||"Open"})]})]})]}),(0,r.jsxs)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:[(0,r.jsx)("h3",{style:{fontSize:"16px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"16px",margin:0},children:"Review Details"}),(0,r.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"What I Learned"}),(0,r.jsx)("textarea",{value:u.whatLearned,onChange:e=>g(r=>({...r,whatLearned:e.target.value})),placeholder:"What did this trade teach you?",style:{width:"100%",padding:"12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none",resize:"vertical",minHeight:"80px",fontFamily:"inherit"},onFocus:e=>{e.currentTarget.style.borderColor="var(--purple-base)"},onBlur:e=>{e.currentTarget.style.borderColor="var(--card-border)"}})]}),(0,r.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"Emotional State"}),(0,r.jsxs)("select",{value:u.emotionalState,onChange:e=>g(r=>({...r,emotionalState:e.target.value})),style:{width:"100%",padding:"8px 12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="var(--purple-base)"},onBlur:e=>{e.currentTarget.style.borderColor="var(--card-border)"},children:[(0,r.jsx)("option",{children:"calm"}),(0,r.jsx)("option",{children:"rushed"}),(0,r.jsx)("option",{children:"frustrated"}),(0,r.jsx)("option",{children:"confident"}),(0,r.jsx)("option",{children:"fearful"})]})]}),(0,r.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"8px"},children:"Setup Quality Rating"}),(0,r.jsxs)("select",{value:u.setupQuality,onChange:e=>g(r=>({...r,setupQuality:parseInt(e.target.value)})),style:{width:"100%",padding:"8px 12px",border:"1px solid var(--card-border)",borderRadius:"6px",backgroundColor:"var(--panel-muted)",color:"var(--text-primary)",fontSize:"13px",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="var(--purple-base)"},onBlur:e=>{e.currentTarget.style.borderColor="var(--card-border)"},children:[(0,r.jsx)("option",{value:"1",children:"⭐ Poor"}),(0,r.jsx)("option",{value:"2",children:"⭐⭐ Below Average"}),(0,r.jsx)("option",{value:"3",children:"⭐⭐⭐ Average"}),(0,r.jsx)("option",{value:"4",children:"⭐⭐⭐⭐ Good"}),(0,r.jsx)("option",{value:"5",children:"⭐⭐⭐⭐⭐ Excellent"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{style:{display:"block",fontSize:"13px",fontWeight:"600",color:"var(--text-primary)",marginBottom:"12px"},children:"Mistakes Made"}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:["Overtraded","Broke rules","Wrong entry point","Hesitated on trade","Exited too early","Exited too late","Ignored analysis","Bad position sizing","Emotion-driven"].map(e=>(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer"},children:[(0,r.jsx)("input",{type:"checkbox",checked:u.mistakes.includes(e),onChange:()=>{g(r=>({...r,mistakes:r.mistakes.includes(e)?r.mistakes.filter(r=>r!==e):[...r.mistakes,e]}))},style:{width:"16px",height:"16px",borderRadius:"4px",border:"1px solid var(--card-border)",cursor:"pointer",accentColor:"var(--purple-base)"}}),(0,r.jsx)("span",{style:{fontSize:"13px",color:"var(--text-primary)"},children:e})]},e))})]})]}),(0,r.jsx)("button",{onClick:b,style:{width:"100%",padding:"12px 16px",background:"linear-gradient(135deg, var(--purple-base) 0%, var(--purple-dark) 100%)",color:"white",fontWeight:"600",fontSize:"14px",border:"none",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 8px 16px rgba(168, 85, 247, 0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"Save Review"})]}):(0,r.jsx)("div",{style:{gridColumn:"auto / span 2",backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"48px 20px",textAlign:"center"},children:(0,r.jsx)("p",{style:{color:"var(--text-secondary)",margin:0,fontSize:"14px"},children:"Select a trade to review"})})]}),y&&(0,r.jsxs)("div",{style:{marginTop:"32px",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"24px"},children:[(0,r.jsx)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:(0,r.jsx)(i,{})}),(0,r.jsx)("div",{style:{backgroundColor:"var(--card-bg)",border:"1px solid var(--card-border)",borderRadius:"12px",padding:"20px"},children:(0,r.jsx)(l,{})})]})]}),(0,r.jsx)(a.Toaster,{position:"bottom-right"})]}):(0,r.jsx)("div",{style:{minHeight:"100vh",backgroundColor:"var(--background)"}})}e.s(["default",()=>d],18924)}]);